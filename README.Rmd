---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```
# rcheology

A data package which lists every command in base R packages since R version 3.0.2.

## Installing

```{r, eval = FALSE}
install.packages("remotes") # if you need to
remotes::install_github("hughjonesd/rcheology")
```


## Running it yourself

* Install docker
* Build the image from `Dockerfile` with `docker build -t rcheology .`
* Run the image with `docker run rcheology`.
* It will download and install multiple versions of R on the container.
* Check the container name with `docker container ls` (or `ls -a` after the process is finished).
* Source `gather-data.R` to get data out of the container and into a CSV file.

## The data

```{r}
library(rcheology)
data("rcheology")

head(rcheology)
```

Package functions over time:

```{r}
xtabs(~ Rversion + package, data = rcheology)

```


New functions in each version:

```{r}
rvs <- as.character(sort(as.package_version(unique(rcheology$Rversion))))

fullname <- paste(rcheology$package, rcheology$name, sep = ":")

wrap <- function (char) paste(char, collapse = "\n")

for (i in seq(2, length(rvs))) {
  old <- fullname[rcheology$Rversion == rvs[i-1]]
  new <- fullname[rcheology$Rversion == rvs[i]]
  introduced <- setdiff(new, old)
  if (length(introduced) > 0) cat("New in ", rvs[i], ":\n", wrap(introduced), "\n")
  removed <- setdiff(old, new)
  if (length(removed) > 0) cat("Removed in ", rvs[i], ":\n", wrap(removed), "\n\n")
}

```

Argument changes:

```{r}
library(dplyr)

for (i in seq(2, length(rvs))) {
  old <- rcheology %>% filter(Rversion == rvs[i-1])
  new <- rcheology %>% filter(Rversion == rvs[i])
  combined <- inner_join(old, new, by = c("name", "package"), suffix = c("_old", "_new"))
  args_changed <- combined %>% filter(args_old != args_new)
  if (nrow(args_changed) > 0){
    cat("Arguments changed in ", rvs[i], ":\n", wrap(args_changed$name), "\n\n")
  }
}

```


